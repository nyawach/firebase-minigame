webpackJsonp([1],{"81aQ":function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};n.d(r,"createPlayer",function(){return k}),n.d(r,"createRoom",function(){return R}),n.d(r,"joinRoom",function(){return j}),n.d(r,"changeTurn",function(){return F});var a={};n.d(a,"setRoomId",function(){return A}),n.d(a,"setPlayerId",function(){return M}),n.d(a,"setStatus",function(){return O}),n.d(a,"setCurrentPlayer",function(){return T});var i,o,s,c=n("7+uW"),u=n("NYxO"),d=n("1nuA"),f=n.n(d),m=n("Xxa5"),p=n.n(m),l=n("bOdI"),h=n.n(l),v=n("exGp"),y=n.n(v),b=n("M4fF"),I=n.n(b),g=n("kxiW"),w=n.n(g).a.initializeApp({apiKey:"AIzaSyDJV5Ta3pn7KSUZUoQMmv1mak9fdAOoRX8",authDomain:"minigame-8bc04.firebaseapp.com",databaseURL:"https://minigame-8bc04.firebaseio.com",projectId:"minigame-8bc04",storageBucket:"minigame-8bc04.appspot.com",messagingSenderId:"112794070469"}).database(),_=function(e){return w.ref("game/"+e+"/players")},S=function(e){return w.ref("game/"+e+"/status")},x=function(e){return w.ref("game/"+e+"/currentPlayer")},P=this,k=function(e){(0,e.commit)("setPlayerId","player"+(1e5*Math.random()|0))},R=(i=y()(p.a.mark(function e(t){var n,r,a=t.state,i=t.commit;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.ref("game").push();case 2:return n=e.sent,"matching",e.next=6,n.set({players:h()({},a.playerId,0),status:"matching"});case 6:r=n.key,i("setRoomId",r);case 8:case"end":return e.stop()}},e,P)})),function(e){return i.apply(this,arguments)}),j=(o=y()(p.a.mark(function e(t){var n,r,a,i=t.state;t.commit;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(i.roomId);case 2:return n=e.sent,r="matched",e.next=6,_(i.roomId);case 6:return a=e.sent,e.next=9,n.set(r);case 9:return e.next=11,a.update(h()({},i.playerId,0));case 11:case"end":return e.stop()}},e,P)})),function(e){return o.apply(this,arguments)}),F=(s=y()(p.a.mark(function e(t){var n=t.state;t.commit;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(n.roomId);case 2:e.sent.once("value",function(e){var t=x(n.roomId),r=e.val(),a=I()(r).keys().filter(function(e){return e!==n.currentPlayer}).value()[0];t.set(a)});case 4:case"end":return e.stop()}},e,P)})),function(e){return s.apply(this,arguments)}),A=function(e,t){e.roomId=t},M=function(e,t){e.playerId=t},O=function(e,t){e.status=t},T=function(e,t){e.currentPlayer=t},U=f.a.parse(window.location.search.slice(1))["room-id"]||null,D={namespaced:!0,state:{roomId:U,status:null,currentPlayer:null,playerId:null,isInvited:!!U},actions:r,mutations:a};c.a.use(u.a);var C=new u.a.Store({modules:{game:D}}),L=n("Dd8w"),N=n.n(L),Q={name:"App",data:function(){return{}},mixins:[{methods:{setFirebaseSubscription:function(e){I.a.each(e,function(e){e.ref.on(e.event||"value",e.fn)})},clearFirebaseSubscription:function(e){I.a.each(e,function(e){e.ref.off(e.event||"value",e.fn)})}},watch:{firebaseSubscription:function(e,t){this.clearFirebaseSubscription(t),this.setFirebaseSubscription(e)}},created:function(){this.setFirebaseSubscription(this.firebaseSubscription)},destroyed:function(){this.clearFirebaseSubscription(this.firebaseSubscription)}}],computed:N()({},Object(u.d)("game",["roomId","playerId","isInvited","status","currentPlayer"]),{roomURL:function(){return window.location.origin+"/?room-id="+this.roomId},firebaseSubscription:function(){var e=this;return[{ref:S(this.roomId),fn:function(t){var n=t.val();console.log("["+t.key+"]: "+n),e.setStatus(n),"matched"!==n?"finished"!==n||e.finish():e.start()}},{ref:x(this.roomId),fn:function(t){console.log("["+t.key+"]: "+t.val()),e.setCurrentPlayer(t.val())}}]},isMyTurn:function(){return this.currentPlayer===this.playerId}}),methods:N()({},Object(u.b)("game",["createRoom","joinRoom","createPlayer","changeTurn"]),Object(u.c)("game",["setStatus","setCurrentPlayer"]),{start:function(){window.alert("start!");(S(this.roomId).set("playing"),this.isInvited)||x(this.roomId).set(this.playerId)},dice:function(){var e,t,n=6*Math.random()+1|0;if(window.alert(n),6===n){var r=S(this.roomId);return this.setStatus("finished"),void r.set("finished")}(e=this.roomId,t=this.playerId,w.ref("game/"+e+"/players/"+t)).set(n),this.changeTurn()},finish:function(){window.alert("finish")}}),mounted:function(){this.createPlayer()}},z={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[e.roomId?n("p",[e._v(e._s(e.roomURL))]):n("button",{on:{click:e.createRoom}},[e._v("部屋を作る")]),e._v(" "),n("p",[e._v("プレイヤーID: "+e._s(e.playerId))]),e._v(" "),n("p",[e._v("ゲームステータス: "+e._s(e.status))]),e._v(" "),e.isInvited&&"matching"==e.status?n("button",{on:{click:e.joinRoom}},[e._v("部屋に入る")]):e._e(),e._v(" "),"playing"===e.status&&e.isMyTurn?n("button",{on:{click:e.dice}},[e._v("dice")]):e._e()])},staticRenderFns:[]};var H=n("VU/8")(Q,z,!1,function(e){n("81aQ")},null,null).exports;c.a.config.productionTip=!1,new c.a({el:"#app",store:C,components:{App:H},template:"<App/>"})}},["NHnr"]);
//# sourceMappingURL=app.abf0937fc121d21b33a1.js.map